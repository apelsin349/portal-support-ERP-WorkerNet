# Инструкция быстрого исправления проблемы с пробелами в ветках

## Проблема
При выборе ветки по номеру в скрипте `quick-update.sh` появляются лишние пробелы:
```
[ИНФО] Выбрана ветка:   new-frontend
[ОШИБКА] Ветка '  new-frontend' не найдена на удаленном репозитории
```

## Быстрое исправление

### Вариант 1: Автоматическое исправление
Выполните следующие команды на сервере:

```bash
# Перейдите в директорию проекта
cd ~/portal-support-ERP-WorkerNet

# Скачайте и запустите скрипт исправления
curl -fsSL https://raw.githubusercontent.com/apelsin349/portal-support-ERP-WorkerNet/main/scripts/emergency-branch-fix.sh -o scripts/emergency-branch-fix.sh
chmod +x scripts/emergency-branch-fix.sh
bash scripts/emergency-branch-fix.sh
```

### Вариант 2: Ручное исправление
Выполните команды вручную:

```bash
# Перейдите в директорию проекта
cd ~/portal-support-ERP-WorkerNet

# Создайте резервную копию
cp scripts/quick-update.sh scripts/quick-update.sh.backup.$(date +%Y%m%d_%H%M%S)

# Исправление 1: Уберите пробел после скобки в команде nl
sed -i "s/nl -w2 -s') '/nl -w2 -s')'/" scripts/quick-update.sh

# Исправление 2: Улучшите обработку выбора ветки по номеру
sed -i 's/SELECTED_BRANCH=$(echo "$available_branches" | sed -n "${choice}p")/SELECTED_BRANCH=$(echo "$available_branches" | sed -n "${choice}p" | sed "s\/^[[:space:]]*\/\/" | sed "s\/[[:space:]]*$\/\/")/' scripts/quick-update.sh

echo "Исправления применены!"
```

### Вариант 3: Одноразовая команда
Выполните эту команду для быстрого исправления:

```bash
cd ~/portal-support-ERP-WorkerNet && cp scripts/quick-update.sh scripts/quick-update.sh.backup.$(date +%Y%m%d_%H%M%S) && sed -i "s/nl -w2 -s') '/nl -w2 -s')'/" scripts/quick-update.sh && sed -i 's/SELECTED_BRANCH=$(echo "$available_branches" | sed -n "${choice}p")/SELECTED_BRANCH=$(echo "$available_branches" | sed -n "${choice}p" | sed "s\/^[[:space:]]*\/\/" | sed "s\/[[:space:]]*$\/\/")/' scripts/quick-update.sh && echo "Исправления применены!"
```

## Проверка исправления

После применения исправлений проверьте:

```bash
# Запустите скрипт обновления
bash scripts/quick-update.sh

# Или используйте конкретную ветку
bash scripts/quick-update.sh --branch new-frontend
```

## Что исправляется

1. **Команда `nl`** - убирается лишний пробел после скобки
2. **Обработка выбора по номеру** - добавляется очистка пробелов при выборе ветки
3. **Валидация названий** - проверка на пустые названия веток

## Восстановление из резервной копии

Если что-то пошло не так:

```bash
# Найдите резервную копию
ls -la scripts/quick-update.sh.backup.*

# Восстановите из резервной копии
cp scripts/quick-update.sh.backup.YYYYMMDD_HHMMSS scripts/quick-update.sh
```

## Альтернативные способы запуска

Если проблема повторяется, используйте:

```bash
# Прямое указание ветки
bash scripts/quick-update.sh --branch new-frontend

# Через переменную окружения
export WORKERNET_BRANCH=new-frontend
bash scripts/quick-update.sh

# Неинтерактивный режим
WORKERNET_NONINTERACTIVE=1 bash scripts/quick-update.sh --branch new-frontend
```
