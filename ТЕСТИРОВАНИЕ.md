# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WorkerNet Portal

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è WorkerNet Portal, –≤–∫–ª—é—á–∞—è unit —Ç–µ—Å—Ç—ã, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã, E2E —Ç–µ—Å—Ç—ã –∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

## –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### 1. Unit —Ç–µ—Å—Ç—ã
- **–¶–µ–ª—å**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: 80%+ –∫–æ–¥–∞
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: < 1 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ç–µ—Å—Ç

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- **–¶–µ–ª—å**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: API endpoints, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: < 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ç–µ—Å—Ç

### 3. E2E —Ç–µ—Å—Ç—ã
- **–¶–µ–ª—å**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—É—Ç–∏
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: < 30 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ç–µ—Å—Ç

### 4. –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
- **–¶–µ–ª—å**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: API endpoints, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 5-30 –º–∏–Ω—É—Ç

## Backend —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã

#### requirements-dev.txt
```txt
pytest==7.4.3
pytest-django==4.7.0
pytest-cov==4.1.0
factory-boy==3.3.0
faker==20.1.0
freezegun==1.2.2
responses==0.23.1
```

#### pytest.ini
```ini
[tool:pytest]
DJANGO_SETTINGS_MODULE = config.settings.test
python_files = tests.py test_*.py *_tests.py
python_classes = Test*
python_functions = test_*
addopts = --cov=. --cov-report=html --cov-report=term-missing
```

#### settings/test.py
```python
from .base import *

DEBUG = True
SECRET_KEY = 'test-secret-key'

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': ':memory:',
    }
}

# –û—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö
CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.dummy.DummyCache',
    }
}

# –û—Ç–∫–ª—é—á–∏—Ç—å Celery –≤ —Ç–µ—Å—Ç–∞—Ö
CELERY_TASK_ALWAYS_EAGER = True
CELERY_TASK_EAGER_PROPAGATES = True

# –û—Ç–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'null': {
            'class': 'logging.NullHandler',
        },
    },
    'root': {
        'handlers': ['null'],
    },
}
```

### Unit —Ç–µ—Å—Ç—ã

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
```python
# app/tests/test_models.py
import pytest
from django.test import TestCase
from django.core.exceptions import ValidationError
from django.contrib.auth import get_user_model
from app.models import Ticket, Tenant
from .factories import TicketFactory, TenantFactory, UserFactory

User = get_user_model()

class TicketModelTest(TestCase):
    def setUp(self):
        self.tenant = TenantFactory()
        self.user = UserFactory(tenant=self.tenant)
        self.ticket = TicketFactory(tenant=self.tenant, created_by=self.user)

    def test_ticket_creation(self):
        self.assertTrue(isinstance(self.ticket, Ticket))
        self.assertEqual(self.ticket.tenant, self.tenant)
        self.assertEqual(self.ticket.created_by, self.user)

    def test_ticket_str_representation(self):
        expected = f"TK-{self.ticket.id:08d}"
        self.assertEqual(str(self.ticket), expected)

    def test_ticket_priority_validation(self):
        with self.assertRaises(ValidationError):
            ticket = TicketFactory(priority='invalid_priority')
            ticket.full_clean()

    def test_ticket_status_transitions(self):
        # –û—Ç–∫—Ä—ã—Ç—ã–π -> –í —Ä–∞–±–æ—Ç–µ
        self.ticket.status = 'in_progress'
        self.ticket.save()
        self.assertEqual(self.ticket.status, 'in_progress')

        # –í —Ä–∞–±–æ—Ç–µ -> –†–µ—à–µ–Ω
        self.ticket.status = 'resolved'
        self.ticket.save()
        self.assertIsNotNone(self.ticket.resolved_at)

    def test_ticket_sla_calculation(self):
        from datetime import datetime, timedelta
        
        # –°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
        ticket = TicketFactory(priority='high', sla_hours=4)
        due_date = ticket.created_at + timedelta(hours=4)
        
        self.assertEqual(ticket.due_date, due_date)
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
```python
# app/tests/test_api.py
import pytest
from django.urls import reverse
from rest_framework.test import APITestCase
from rest_framework import status
from django.contrib.auth import get_user_model
from app.models import Ticket
from .factories import TicketFactory, UserFactory, TenantFactory

User = get_user_model()

class TicketAPITest(APITestCase):
    def setUp(self):
        self.tenant = TenantFactory()
        self.user = UserFactory(tenant=self.tenant)
        self.client.force_authenticate(user=self.user)

    def test_list_tickets(self):
        # –°–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–∫–µ—Ç–æ–≤
        TicketFactory.create_batch(3, tenant=self.tenant, created_by=self.user)
        
        url = reverse('ticket-list')
        response = self.client.get(url)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(len(response.data['results']), 3)

    def test_create_ticket(self):
        url = reverse('ticket-list')
        data = {
            'title': '–ù–æ–≤—ã–π —Ç–∏–∫–µ—Ç',
            'description': '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞',
            'priority': 'medium',
            'category': 'technical'
        }
        
        response = self.client.post(url, data)
        
        self.assertEqual(response.status_code, status.HTTP_201_CREATED)
        self.assertEqual(Ticket.objects.count(), 1)
        
        ticket = Ticket.objects.first()
        self.assertEqual(ticket.title, data['title'])
        self.assertEqual(ticket.tenant, self.tenant)

    def test_update_ticket(self):
        ticket = TicketFactory(tenant=self.tenant, created_by=self.user)
        
        url = reverse('ticket-detail', kwargs={'pk': ticket.pk})
        data = {'title': '–û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'}
        
        response = self.client.patch(url, data)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        ticket.refresh_from_db()
        self.assertEqual(ticket.title, data['title'])

    def test_delete_ticket(self):
        ticket = TicketFactory(tenant=self.tenant, created_by=self.user)
        
        url = reverse('ticket-detail', kwargs={'pk': ticket.pk})
        response = self.client.delete(url)
        
        self.assertEqual(response.status_code, status.HTTP_204_NO_CONTENT)
        self.assertEqual(Ticket.objects.count(), 0)

    def test_assign_ticket(self):
        ticket = TicketFactory(tenant=self.tenant, created_by=self.user)
        assignee = UserFactory(tenant=self.tenant)
        
        url = reverse('ticket-assign', kwargs={'pk': ticket.pk})
        data = {'user_id': assignee.id}
        
        response = self.client.post(url, data)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        ticket.refresh_from_db()
        self.assertEqual(ticket.assigned_to, assignee)

    def test_unauthorized_access(self):
        self.client.logout()
        
        url = reverse('ticket-list')
        response = self.client.get(url)
        
        self.assertEqual(response.status_code, status.HTTP_401_UNAUTHORIZED)
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
```python
# app/tests/test_services.py
import pytest
from unittest.mock import patch, Mock
from app.services import TicketService, NotificationService
from .factories import TicketFactory, UserFactory

class TicketServiceTest(TestCase):
    def setUp(self):
        self.user = UserFactory()
        self.ticket = TicketFactory(created_by=self.user)

    @patch('app.services.NotificationService.send_notification')
    def test_assign_ticket_sends_notification(self, mock_send):
        assignee = UserFactory()
        
        TicketService.assign_ticket(self.ticket, assignee)
        
        mock_send.assert_called_once_with(
            user=assignee,
            type='ticket_assigned',
            data={'ticket_id': self.ticket.id}
        )

    def test_calculate_sla_hours(self):
        # –¢–µ—Å—Ç —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
        ticket = TicketFactory(priority='high')
        sla_hours = TicketService.calculate_sla_hours(ticket.priority)
        self.assertEqual(sla_hours, 4)

        # –¢–µ—Å—Ç —Å –Ω–∏–∑–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
        ticket = TicketFactory(priority='low')
        sla_hours = TicketService.calculate_sla_hours(ticket.priority)
        self.assertEqual(sla_hours, 72)

    def test_escalate_overdue_tickets(self):
        from datetime import datetime, timedelta
        from django.utils import timezone
        
        # –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π —Ç–∏–∫–µ—Ç
        overdue_time = timezone.now() - timedelta(hours=25)
        overdue_ticket = TicketFactory(
            priority='high',
            status='open',
            created_at=overdue_time
        )
        
        # –°–æ–∑–¥–∞—Ç—å –Ω–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π —Ç–∏–∫–µ—Ç
        recent_ticket = TicketFactory(
            priority='high',
            status='open',
            created_at=timezone.now() - timedelta(hours=2)
        )
        
        escalated_tickets = TicketService.escalate_overdue_tickets()
        
        self.assertIn(overdue_ticket, escalated_tickets)
        self.assertNotIn(recent_ticket, escalated_tickets)
```

### –§–∞–±—Ä–∏–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

#### factories.py
```python
# app/tests/factories.py
import factory
from factory.django import DjangoModelFactory
from django.contrib.auth import get_user_model
from app.models import Ticket, Tenant, KnowledgeArticle

User = get_user_model()

class TenantFactory(DjangoModelFactory):
    class Meta:
        model = Tenant

    name = factory.Sequence(lambda n: f"Tenant {n}")
    slug = factory.Sequence(lambda n: f"tenant-{n}")
    domain = factory.Sequence(lambda n: f"tenant{n}.example.com")
    is_active = True

class UserFactory(DjangoModelFactory):
    class Meta:
        model = User

    username = factory.Sequence(lambda n: f"user{n}")
    email = factory.LazyAttribute(lambda obj: f"{obj.username}@example.com")
    first_name = factory.Faker('first_name')
    last_name = factory.Faker('last_name')
    tenant = factory.SubFactory(TenantFactory)
    is_active = True

class TicketFactory(DjangoModelFactory):
    class Meta:
        model = Ticket

    title = factory.Faker('sentence', nb_words=4)
    description = factory.Faker('text', max_nb_chars=500)
    priority = factory.Iterator(['low', 'medium', 'high', 'urgent', 'critical'])
    status = factory.Iterator(['open', 'in_progress', 'pending', 'resolved', 'closed'])
    category = factory.Iterator(['technical', 'billing', 'general', 'bug_report', 'feature_request'])
    tenant = factory.SubFactory(TenantFactory)
    created_by = factory.SubFactory(UserFactory)

class KnowledgeArticleFactory(DjangoModelFactory):
    class Meta:
        model = KnowledgeArticle

    title = factory.Faker('sentence', nb_words=6)
    content = factory.Faker('text', max_nb_chars=2000)
    excerpt = factory.Faker('text', max_nb_chars=200)
    status = factory.Iterator(['draft', 'published', 'archived'])
    author = factory.SubFactory(UserFactory)
    tenant = factory.SubFactory(TenantFactory)
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
```python
# app/tests/test_integration.py
import pytest
from django.test import TransactionTestCase
from django.db import transaction
from app.models import Ticket, Comment
from .factories import TicketFactory, UserFactory

class TicketIntegrationTest(TransactionTestCase):
    def test_ticket_with_comments_workflow(self):
        user = UserFactory()
        ticket = TicketFactory(created_by=user)
        
        # –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
        comment = Comment.objects.create(
            ticket=ticket,
            author=user,
            content="–ü–µ—Ä–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"
        )
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—å
        self.assertEqual(ticket.comments.count(), 1)
        self.assertEqual(comment.ticket, ticket)
        
        # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ç–∏–∫–µ—Ç–∞
        ticket.status = 'in_progress'
        ticket.save()
        
        # –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ –æ–¥–∏–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
        Comment.objects.create(
            ticket=ticket,
            author=user,
            content="–í—Ç–æ—Ä–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"
        )
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        self.assertEqual(ticket.comments.count(), 2)
        self.assertEqual(ticket.status, 'in_progress')
```

## Frontend —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã

#### package.json
```json
{
  "devDependencies": {
    "@testing-library/react": "^14.0.0",
    "@testing-library/jest-dom": "^5.16.5",
    "@testing-library/user-event": "^14.4.3",
    "jest": "^29.4.3",
    "jest-environment-jsdom": "^29.4.3",
    "cypress": "^12.7.0",
    "cypress-real-events": "^1.7.1"
  }
}
```

#### jest.config.js
```javascript
module.exports = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/src/setupTests.ts'],
  moduleNameMapping: {
    '^@/(.*)$': '<rootDir>/src/$1',
  },
  collectCoverageFrom: [
    'src/**/*.{ts,tsx}',
    '!src/**/*.d.ts',
    '!src/index.tsx',
    '!src/reportWebVitals.ts',
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80,
    },
  },
};
```

#### src/setupTests.ts
```typescript
import '@testing-library/jest-dom';
import { configure } from '@testing-library/react';

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã
configure({ testIdAttribute: 'data-testid' });

// –ú–æ–∫ –¥–ª—è window.matchMedia
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: jest.fn().mockImplementation(query => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: jest.fn(),
    removeListener: jest.fn(),
    addEventListener: jest.fn(),
    removeEventListener: jest.fn(),
    dispatchEvent: jest.fn(),
  })),
});
```

### Unit —Ç–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```typescript
// src/components/Ticket/Ticket.test.tsx
import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { Provider } from 'react-redux';
import { BrowserRouter } from 'react-router-dom';
import { Ticket } from './Ticket';
import { store } from '../../store';
import { mockTicket } from '../../mocks/ticket';

const renderWithProviders = (component: React.ReactElement) => {
  return render(
    <Provider store={store}>
      <BrowserRouter>
        {component}
      </BrowserRouter>
    </Provider>
  );
};

describe('Ticket Component', () => {
  const user = userEvent.setup();

  test('renders ticket information', () => {
    renderWithProviders(<Ticket ticket={mockTicket} />);
    
    expect(screen.getByText(mockTicket.title)).toBeInTheDocument();
    expect(screen.getByText(mockTicket.description)).toBeInTheDocument();
    expect(screen.getByText(mockTicket.priority)).toBeInTheDocument();
  });

  test('handles status change', async () => {
    const onStatusChange = jest.fn();
    renderWithProviders(
      <Ticket ticket={mockTicket} onStatusChange={onStatusChange} />
    );
    
    const statusSelect = screen.getByTestId('status-select');
    await user.selectOptions(statusSelect, 'in_progress');
    
    expect(onStatusChange).toHaveBeenCalledWith('in_progress');
  });

  test('shows comments when expanded', async () => {
    renderWithProviders(<Ticket ticket={mockTicket} />);
    
    const expandButton = screen.getByTestId('expand-comments');
    await user.click(expandButton);
    
    await waitFor(() => {
      expect(screen.getByTestId('comments-list')).toBeInTheDocument();
    });
  });

  test('handles comment submission', async () => {
    const onCommentSubmit = jest.fn();
    renderWithProviders(
      <Ticket ticket={mockTicket} onCommentSubmit={onCommentSubmit} />
    );
    
    const commentInput = screen.getByTestId('comment-input');
    const submitButton = screen.getByTestId('submit-comment');
    
    await user.type(commentInput, '–ù–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π');
    await user.click(submitButton);
    
    expect(onCommentSubmit).toHaveBeenCalledWith('–ù–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π');
  });
});
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ hooks
```typescript
// src/hooks/useApi.test.ts
import { renderHook, waitFor } from '@testing-library/react';
import { useApi } from './useApi';
import { mockFetch } from '../../mocks/fetch';

// –ú–æ–∫ –¥–ª—è fetch
global.fetch = mockFetch;

describe('useApi Hook', () => {
  test('should make GET request', async () => {
    const { result } = renderHook(() => useApi());
    
    const response = await result.current.get('/api/tickets/');
    
    expect(response).toEqual({ results: [] });
    expect(fetch).toHaveBeenCalledWith('/api/tickets/', {
      headers: {
        'Content-Type': 'application/json',
      },
    });
  });

  test('should make POST request with data', async () => {
    const { result } = renderHook(() => useApi());
    const data = { title: 'Test Ticket' };
    
    const response = await result.current.post('/api/tickets/', data);
    
    expect(response).toEqual({ id: 1, title: 'Test Ticket' });
    expect(fetch).toHaveBeenCalledWith('/api/tickets/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    });
  });

  test('should handle errors', async () => {
    mockFetch.mockRejectedValueOnce(new Error('Network error'));
    
    const { result } = renderHook(() => useApi());
    
    await expect(result.current.get('/api/tickets/')).rejects.toThrow('Network error');
  });
});
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Redux
```typescript
// src/store/slices/ticketSlice.test.ts
import ticketReducer, { 
  fetchTickets, 
  createTicket, 
  updateTicket 
} from './ticketSlice';
import { mockTicket } from '../../mocks/ticket';

describe('Ticket Slice', () => {
  const initialState = {
    tickets: [],
    loading: false,
    error: null,
  };

  test('should handle fetchTickets.pending', () => {
    const action = { type: fetchTickets.pending.type };
    const state = ticketReducer(initialState, action);
    
    expect(state.loading).toBe(true);
    expect(state.error).toBeNull();
  });

  test('should handle fetchTickets.fulfilled', () => {
    const tickets = [mockTicket];
    const action = { 
      type: fetchTickets.fulfilled.type, 
      payload: { results: tickets } 
    };
    const state = ticketReducer(initialState, action);
    
    expect(state.loading).toBe(false);
    expect(state.tickets).toEqual(tickets);
    expect(state.error).toBeNull();
  });

  test('should handle fetchTickets.rejected', () => {
    const error = 'Failed to fetch tickets';
    const action = { 
      type: fetchTickets.rejected.type, 
      error: { message: error } 
    };
    const state = ticketReducer(initialState, action);
    
    expect(state.loading).toBe(false);
    expect(state.error).toBe(error);
  });
});
```

### E2E —Ç–µ—Å—Ç—ã

#### Cypress –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```javascript
// cypress.config.js
const { defineConfig } = require('cypress');

module.exports = defineConfig({
  e2e: {
    baseUrl: 'http://localhost:3000',
    supportFile: 'cypress/support/e2e.ts',
    specPattern: 'cypress/e2e/**/*.cy.{js,jsx,ts,tsx}',
    viewportWidth: 1280,
    viewportHeight: 720,
    video: true,
    screenshotOnRunFailure: true,
  },
});
```

#### E2E —Ç–µ—Å—Ç—ã
```typescript
// cypress/e2e/ticket-workflow.cy.ts
describe('Ticket Workflow', () => {
  beforeEach(() => {
    cy.visit('/');
    cy.login('admin', 'admin123');
  });

  it('should create and manage ticket', () => {
    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞
    cy.get('[data-testid="create-ticket-button"]').click();
    
    cy.get('[data-testid="ticket-title-input"]').type('–¢–µ—Å—Ç–æ–≤—ã–π —Ç–∏–∫–µ—Ç');
    cy.get('[data-testid="ticket-description-input"]').type('–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ç–∏–∫–µ—Ç–∞');
    cy.get('[data-testid="ticket-priority-select"]').select('high');
    cy.get('[data-testid="ticket-category-select"]').select('technical');
    
    cy.get('[data-testid="submit-ticket-button"]').click();
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è
    cy.get('[data-testid="ticket-list"]').should('contain', '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–∏–∫–µ—Ç');
    
    // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ç–∏–∫–µ—Ç–∞
    cy.get('[data-testid="ticket-item"]').first().click();
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
    cy.get('[data-testid="comment-input"]').type('–ü–µ—Ä–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π');
    cy.get('[data-testid="submit-comment-button"]').click();
    
    cy.get('[data-testid="comments-list"]').should('contain', '–ü–µ—Ä–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π');
    
    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
    cy.get('[data-testid="status-select"]').select('in_progress');
    
    cy.get('[data-testid="ticket-status"]').should('contain', '–í —Ä–∞–±–æ—Ç–µ');
    
    // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞
    cy.get('[data-testid="assign-button"]').click();
    cy.get('[data-testid="assignee-select"]').select('support1');
    cy.get('[data-testid="confirm-assign-button"]').click();
    
    cy.get('[data-testid="ticket-assignee"]').should('contain', 'support1');
  });

  it('should search and filter tickets', () => {
    // –ü–æ–∏—Å–∫ —Ç–∏–∫–µ—Ç–æ–≤
    cy.get('[data-testid="search-input"]').type('–æ—à–∏–±–∫–∞');
    cy.get('[data-testid="search-button"]').click();
    
    cy.get('[data-testid="ticket-list"]').should('contain', '–æ—à–∏–±–∫–∞');
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
    cy.get('[data-testid="status-filter"]').select('open');
    cy.get('[data-testid="apply-filters-button"]').click();
    
    cy.get('[data-testid="ticket-item"]').each(($el) => {
      cy.wrap($el).should('contain', '–û—Ç–∫—Ä—ã—Ç');
    });
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
    cy.get('[data-testid="priority-filter"]').select('high');
    cy.get('[data-testid="apply-filters-button"]').click();
    
    cy.get('[data-testid="ticket-item"]').each(($el) => {
      cy.wrap($el).should('contain', '–í—ã—Å–æ–∫–∏–π');
    });
  });
});
```

#### –ö–æ–º–∞–Ω–¥—ã Cypress
```typescript
// cypress/support/commands.ts
declare global {
  namespace Cypress {
    interface Chainable {
      login(username: string, password: string): Chainable<void>;
      createTicket(ticket: any): Chainable<void>;
      waitForApiCall(alias: string): Chainable<void>;
    }
  }
}

Cypress.Commands.add('login', (username: string, password: string) => {
  cy.session([username, password], () => {
    cy.visit('/login');
    cy.get('[data-testid="username-input"]').type(username);
    cy.get('[data-testid="password-input"]').type(password);
    cy.get('[data-testid="login-button"]').click();
    cy.url().should('include', '/dashboard');
  });
});

Cypress.Commands.add('createTicket', (ticket: any) => {
  cy.request({
    method: 'POST',
    url: '/api/tickets/',
    body: ticket,
    headers: {
      'Authorization': `Bearer ${Cypress.env('authToken')}`,
    },
  });
});

Cypress.Commands.add('waitForApiCall', (alias: string) => {
  cy.wait(alias).then((interception) => {
    expect(interception.response?.statusCode).to.be.oneOf([200, 201]);
  });
});
```

## –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Locust –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```python
# load_tests/locustfile.py
from locust import HttpUser, task, between
import random

class TicketUser(HttpUser):
    wait_time = between(1, 3)
    
    def on_start(self):
        # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
        response = self.client.post("/api/auth/login/", {
            "username": "testuser",
            "password": "testpass"
        })
        self.token = response.json()["access"]
        self.headers = {"Authorization": f"Bearer {self.token}"}
    
    @task(3)
    def list_tickets(self):
        self.client.get("/api/tickets/", headers=self.headers)
    
    @task(2)
    def create_ticket(self):
        self.client.post("/api/tickets/", {
            "title": f"Test Ticket {random.randint(1, 1000)}",
            "description": "Test description",
            "priority": random.choice(["low", "medium", "high"]),
            "category": random.choice(["technical", "billing", "general"])
        }, headers=self.headers)
    
    @task(1)
    def get_ticket(self):
        ticket_id = random.randint(1, 100)
        self.client.get(f"/api/tickets/{ticket_id}/", headers=self.headers)
```

### –ó–∞–ø—É—Å–∫ –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Locust
pip install locust

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
locust -f load_tests/locustfile.py --host=http://localhost:8000

# –ó–∞–ø—É—Å–∫ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
locust -f load_tests/locustfile.py \
  --host=http://localhost:8000 \
  --users=100 \
  --spawn-rate=10 \
  --run-time=5m

# –ó–∞–ø—É—Å–∫ –≤ headless —Ä–µ–∂–∏–º–µ
locust -f load_tests/locustfile.py \
  --host=http://localhost:8000 \
  --users=50 \
  --spawn-rate=5 \
  --run-time=2m \
  --headless
```

## CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### GitHub Actions
```yaml
# .github/workflows/test.yml
name: Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  backend-tests:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: test_db
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
      
      redis:
        image: redis:7
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        cd backend
        pip install -r requirements.txt
        pip install -r requirements-dev.txt
    
    - name: Run tests
      run: |
        cd backend
        python manage.py test
      env:
        DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test_db
        REDIS_URL: redis://localhost:6379/0

  frontend-tests:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    
    - name: Install dependencies
      run: |
        cd frontend
        npm ci
    
    - name: Run tests
      run: |
        cd frontend
        npm test -- --coverage --watchAll=false
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        file: frontend/coverage/lcov.info

  e2e-tests:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Install dependencies
      run: |
        cd frontend
        npm ci
    
    - name: Run Cypress tests
      run: |
        cd frontend
        npm run cypress:run
      env:
        CYPRESS_baseUrl: http://localhost:3000
```

## –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
```bash
# Backend –ø–æ–∫—Ä—ã—Ç–∏–µ
cd backend
coverage run --source='.' manage.py test
coverage report
coverage html

# Frontend –ø–æ–∫—Ä—ã—Ç–∏–µ
cd frontend
npm test -- --coverage
```

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
```bash
# Backend
cd backend
flake8 .
black --check .
isort --check-only .

# Frontend
cd frontend
npm run lint
npm run type-check
```

## –û—Ç—á–µ—Ç—ã

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
```bash
# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤
mkdir -p reports

# Backend –æ—Ç—á–µ—Ç—ã
cd backend
coverage html -d ../reports/backend-coverage
pytest --html=../reports/backend-report.html --self-contained-html

# Frontend –æ—Ç—á–µ—Ç—ã
cd frontend
npm test -- --coverage --coverageReporters=html
cp -r coverage ../reports/frontend-coverage

# E2E –æ—Ç—á–µ—Ç—ã
cd frontend
npm run cypress:run -- --reporter html --reporter-options output=../reports/e2e-report.html
```

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è WorkerNet Portal –≤–∫–ª—é—á–∞–µ—Ç:

- ‚úÖ **Unit —Ç–µ—Å—Ç—ã**: 80%+ –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**: API –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **E2E —Ç–µ—Å—Ç—ã**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- ‚úÖ **–ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã**: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ **CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- ‚úÖ **–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤:**
- `python manage.py test` - Backend —Ç–µ—Å—Ç—ã
- `pytest` - Backend —Ç–µ—Å—Ç—ã —Å pytest
- `npm test` - Frontend —Ç–µ—Å—Ç—ã
- `npm run cypress:run` - E2E —Ç–µ—Å—Ç—ã
- `locust -f load_tests/locustfile.py` - –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `docker compose exec backend python manage.py test` - –¢–µ—Å—Ç—ã –≤ Docker
