# üöÄ –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ WorkerNet Portal - –ß–∞—Å—Ç—å 2

*–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ [–ü–û–õ–ù–û–ï_–†–£–ö–û–í–û–î–°–¢–í–û.md](–ü–û–õ–ù–û–ï_–†–£–ö–û–í–û–î–°–¢–í–û.md)*

---

## üé® –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

#### 1. Clean Architecture

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ models/          # Django –º–æ–¥–µ–ª–∏ (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
‚îÇ   ‚îú‚îÄ‚îÄ api/             # REST API (–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views/       # API –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers/ # –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ urls/        # URL –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ core/            # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/    # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/       # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exceptions/  # –ò—Å–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ tasks/           # Celery –∑–∞–¥–∞—á–∏
```

#### 2. Domain-Driven Design (DDD)

**–ê–≥—Ä–µ–≥–∞—Ç—ã –∏ —Å—É—â–Ω–æ—Å—Ç–∏:**
```python
# domain/aggregates/ticket_aggregate.py
from dataclasses import dataclass
from typing import List
from .entities.ticket import Ticket
from .entities.comment import Comment

@dataclass
class TicketAggregate:
    ticket: Ticket
    comments: List[Comment]
    
    def add_comment(self, content: str, author_id: int) -> None:
        comment = Comment(
            content=content,
            author_id=author_id,
            ticket_id=self.ticket.id
        )
        self.comments.append(comment)
    
    def change_status(self, new_status: TicketStatus) -> None:
        if self.ticket.status == TicketStatus.CLOSED:
            raise ValueError("Cannot change status of closed ticket")
        self.ticket.status = new_status
```

#### 3. CQRS (Command Query Responsibility Segregation)

**–ö–æ–º–∞–Ω–¥—ã:**
```python
# application/commands/create_ticket_command.py
from dataclasses import dataclass
from typing import Optional

@dataclass
class CreateTicketCommand:
    title: str
    description: str
    priority: str
    category: str
    created_by_id: int
    assigned_to_id: Optional[int] = None
```

**–ó–∞–ø—Ä–æ—Å—ã:**
```python
# application/queries/get_tickets_query.py
from dataclasses import dataclass
from typing import Optional, List
from .dto.ticket_dto import TicketDto

@dataclass
class GetTicketsQuery:
    status: Optional[str] = None
    priority: Optional[str] = None
    assigned_to: Optional[int] = None
    limit: int = 20
    offset: int = 0

@dataclass
class GetTicketsResult:
    tickets: List[TicketDto]
    total_count: int
```

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

#### 1. Code Quality

**Pre-commit hooks:**
```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
      - id: check-merge-conflict

  - repo: https://github.com/psf/black
    rev: 23.3.0
    hooks:
      - id: black
        language_version: python3.11

  - repo: https://github.com/pycqa/isort
    rev: 5.12.0
    hooks:
      - id: isort
        args: ["--profile", "black"]

  - repo: https://github.com/pycqa/flake8
    rev: 6.0.0
    hooks:
      - id: flake8
        args: [--max-line-length=88, --extend-ignore=E203]

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.3.0
    hooks:
      - id: mypy
        additional_dependencies: [types-all]
```

**ESLint –∏ Prettier:**
```json
// .eslintrc.js
module.exports = {
  extends: [
    'eslint:recommended',
    '@typescript-eslint/recommended',
    'plugin:react/recommended',
    'plugin:react-hooks/recommended',
  ],
  parser: '@typescript-eslint/parser',
  plugins: ['@typescript-eslint', 'react', 'react-hooks'],
  rules: {
    'react/prop-types': 'off',
    '@typescript-eslint/explicit-function-return-type': 'off',
    '@typescript-eslint/explicit-module-boundary-types': 'off',
    '@typescript-eslint/no-explicit-any': 'warn',
  },
  settings: {
    react: {
      version: 'detect',
    },
  },
};
```

#### 2. Testing

**Pytest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```python
# pytest.ini
[tool:pytest]
DJANGO_SETTINGS_MODULE = config.settings.test
python_files = tests.py test_*.py *_tests.py
python_classes = Test*
python_functions = test_*
addopts = 
    --cov=.
    --cov-report=html
    --cov-report=term-missing
    --cov-fail-under=80
    --strict-markers
    --disable-warnings
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
```

**Jest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```javascript
// jest.config.js
module.exports = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/src/setupTests.ts'],
  moduleNameMapping: {
    '^@/(.*)$': '<rootDir>/src/$1',
  },
  collectCoverageFrom: [
    'src/**/*.{ts,tsx}',
    '!src/**/*.d.ts',
    '!src/index.tsx',
    '!src/reportWebVitals.ts',
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80,
    },
  },
  testMatch: [
    '<rootDir>/src/**/__tests__/**/*.{ts,tsx}',
    '<rootDir>/src/**/*.{test,spec}.{ts,tsx}',
  ],
};
```

#### 3. CI/CD

**GitHub Actions:**
```yaml
# .github/workflows/ci.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: test_db
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
      
      redis:
        image: redis:7
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    
    - name: Install Python dependencies
      run: |
        cd backend
        pip install -r requirements.txt
        pip install -r requirements-dev.txt
    
    - name: Install Node.js dependencies
      run: |
        cd frontend
        npm ci
    
    - name: Run Python tests
      run: |
        cd backend
        python manage.py test
      env:
        DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test_db
        REDIS_URL: redis://localhost:6379/0
    
    - name: Run Node.js tests
      run: |
        cd frontend
        npm test -- --coverage --watchAll=false
    
    - name: Run E2E tests
      run: |
        cd frontend
        npm run cypress:run
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        files: ./backend/coverage.xml,./frontend/coverage/lcov.info
```

### –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

#### 1. Git Flow

**–í–µ—Ç–∫–∏:**
```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –≤–µ—Ç–∫–∏
main        # –ü—Ä–æ–¥–∞–∫—à–Ω –∫–æ–¥
develop     # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –≤–µ—Ç–∫–∞

# –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –≤–µ—Ç–∫–∏
feature/*   # –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
release/*   # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ–ª–∏–∑–∞
hotfix/*    # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```

**Workflow:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ feature –≤–µ—Ç–∫–∏
git checkout develop
git pull origin develop
git checkout -b feature/new-feature

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
git add .
git commit -m "feat: add new feature"
git push origin feature/new-feature

# –°–æ–∑–¥–∞–Ω–∏–µ Pull Request
# –ü–æ—Å–ª–µ review –∏ approval:
git checkout develop
git pull origin develop
git merge feature/new-feature
git push origin develop
git branch -d feature/new-feature
```

#### 2. Conventional Commits

**–§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–æ–≤:**
```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

**–¢–∏–ø—ã –∫–æ–º–º–∏—Ç–æ–≤:**
```
feat:     –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
fix:      –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞
docs:     –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
style:    —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
refactor: —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
test:     –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
chore:    –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
feat(auth): add JWT token refresh functionality
fix(api): resolve CORS issue with frontend
docs(readme): update installation instructions
style(components): format code with prettier
refactor(services): extract ticket service logic
test(api): add integration tests for ticket endpoints
chore(deps): update Django to 4.2.1
```

### DevOps –ø—Ä–∞–∫—Ç–∏–∫–∏

#### 1. Infrastructure as Code

**Terraform:**
```hcl
# main.tf
provider "aws" {
  region = "us-west-2"
}

resource "aws_instance" "app_server" {
  ami           = "ami-0c55b159cbfafe1d0"
  instance_type = "t3.medium"
  
  tags = {
    Name = "workernet-app-server"
    Environment = "production"
  }
}

resource "aws_db_instance" "postgres" {
  identifier = "workernet-db"
  engine     = "postgres"
  engine_version = "15.3"
  instance_class = "db.t3.micro"
  allocated_storage = 20
  
  db_name  = "workernet"
  username = "workernet"
  password = var.db_password
  
  vpc_security_group_ids = [aws_security_group.db.id]
  
  tags = {
    Name = "workernet-database"
  }
}
```

#### 2. Containerization

**Multi-stage Docker builds:**
```dockerfile
# Backend Dockerfile
FROM python:3.11-slim as builder

WORKDIR /app
COPY backend/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

FROM python:3.11-slim as production

WORKDIR /app
COPY --from=builder /usr/local/lib/python3.11/site-packages /usr/local/lib/python3.11/site-packages
COPY --from=builder /usr/local/bin /usr/local/bin

COPY backend/ .
RUN python manage.py collectstatic --noinput

EXPOSE 8000
CMD ["gunicorn", "config.wsgi:application", "--bind", "0.0.0.0:8000"]
```

```dockerfile
# Frontend Dockerfile
FROM node:18-alpine as builder

WORKDIR /app
COPY frontend/package*.json ./
RUN npm ci --only=production

COPY frontend/ .
RUN npm run build

FROM nginx:alpine as production
COPY --from=builder /app/build /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

#### 3. Kubernetes

**Deployment:**
```yaml
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: workernet-backend
spec:
  replicas: 3
  selector:
    matchLabels:
      app: workernet-backend
  template:
    metadata:
      labels:
        app: workernet-backend
    spec:
      containers:
      - name: backend
        image: workernet/backend:latest
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: workernet-secrets
              key: database-url
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: workernet-secrets
              key: redis-url
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health/
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health/
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 5
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤
1. **Unit —Ç–µ—Å—Ç—ã**
   - **–¶–µ–ª—å**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - **–ü–æ–∫—Ä—ã—Ç–∏–µ**: 80%+ –∫–æ–¥–∞
   - **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: < 1 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ —Ç–µ—Å—Ç

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**
   - **–¶–µ–ª—å**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
   - **–ü–æ–∫—Ä—ã—Ç–∏–µ**: API endpoints, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
   - **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: < 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ç–µ—Å—Ç

3. **E2E —Ç–µ—Å—Ç—ã**
   - **–¶–µ–ª—å**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
   - **–ü–æ–∫—Ä—ã—Ç–∏–µ**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—É—Ç–∏
   - **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: < 30 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ç–µ—Å—Ç

4. **–ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã**
   - **–¶–µ–ª—å**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π
   - **–ü–æ–∫—Ä—ã—Ç–∏–µ**: API endpoints, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
   - **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 5-30 –º–∏–Ω—É—Ç

### Backend —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã

**requirements-dev.txt:**
```txt
pytest==7.4.3
pytest-django==4.7.0
pytest-cov==4.1.0
factory-boy==3.3.0
faker==20.1.0
freezegun==1.2.2
responses==0.23.1
```

**settings/test.py:**
```python
from .base import *

DEBUG = True
SECRET_KEY = 'test-secret-key'

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': ':memory:',
    }
}

# –û—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö
CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.dummy.DummyCache',
    }
}

# –û—Ç–∫–ª—é—á–∏—Ç—å Celery –≤ —Ç–µ—Å—Ç–∞—Ö
CELERY_TASK_ALWAYS_EAGER = True
CELERY_TASK_EAGER_PROPAGATES = True
```

#### Unit —Ç–µ—Å—Ç—ã

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π:**
```python
# app/tests/test_models.py
import pytest
from django.test import TestCase
from django.core.exceptions import ValidationError
from django.contrib.auth import get_user_model
from app.models import Ticket, Tenant
from .factories import TicketFactory, TenantFactory, UserFactory

User = get_user_model()

class TicketModelTest(TestCase):
    def setUp(self):
        self.tenant = TenantFactory()
        self.user = UserFactory(tenant=self.tenant)
        self.ticket = TicketFactory(tenant=self.tenant, created_by=self.user)

    def test_ticket_creation(self):
        self.assertTrue(isinstance(self.ticket, Ticket))
        self.assertEqual(self.ticket.tenant, self.tenant)
        self.assertEqual(self.ticket.created_by, self.user)

    def test_ticket_str_representation(self):
        expected = f"TK-{self.ticket.id:08d}"
        self.assertEqual(str(self.ticket), expected)

    def test_ticket_priority_validation(self):
        with self.assertRaises(ValidationError):
            ticket = TicketFactory(priority='invalid_priority')
            ticket.full_clean()

    def test_ticket_status_transitions(self):
        # –û—Ç–∫—Ä—ã—Ç—ã–π -> –í —Ä–∞–±–æ—Ç–µ
        self.ticket.status = 'in_progress'
        self.ticket.save()
        self.assertEqual(self.ticket.status, 'in_progress')

        # –í —Ä–∞–±–æ—Ç–µ -> –†–µ—à–µ–Ω
        self.ticket.status = 'resolved'
        self.ticket.save()
        self.assertIsNotNone(self.ticket.resolved_at)
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API:**
```python
# app/tests/test_api.py
import pytest
from django.urls import reverse
from rest_framework.test import APITestCase
from rest_framework import status
from django.contrib.auth import get_user_model
from app.models import Ticket
from .factories import TicketFactory, UserFactory, TenantFactory

User = get_user_model()

class TicketAPITest(APITestCase):
    def setUp(self):
        self.tenant = TenantFactory()
        self.user = UserFactory(tenant=self.tenant)
        self.client.force_authenticate(user=self.user)

    def test_list_tickets(self):
        # –°–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–∫–µ—Ç–æ–≤
        TicketFactory.create_batch(3, tenant=self.tenant, created_by=self.user)
        
        url = reverse('ticket-list')
        response = self.client.get(url)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(len(response.data['results']), 3)

    def test_create_ticket(self):
        url = reverse('ticket-list')
        data = {
            'title': '–ù–æ–≤—ã–π —Ç–∏–∫–µ—Ç',
            'description': '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞',
            'priority': 'medium',
            'category': 'technical'
        }
        
        response = self.client.post(url, data)
        
        self.assertEqual(response.status_code, status.HTTP_201_CREATED)
        self.assertEqual(Ticket.objects.count(), 1)
        
        ticket = Ticket.objects.first()
        self.assertEqual(ticket.title, data['title'])
        self.assertEqual(ticket.tenant, self.tenant)

    def test_unauthorized_access(self):
        self.client.logout()
        
        url = reverse('ticket-list')
        response = self.client.get(url)
        
        self.assertEqual(response.status_code, status.HTTP_401_UNAUTHORIZED)
```

#### –§–∞–±—Ä–∏–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

**factories.py:**
```python
# app/tests/factories.py
import factory
from factory.django import DjangoModelFactory
from django.contrib.auth import get_user_model
from app.models import Ticket, Tenant, KnowledgeArticle

User = get_user_model()

class TenantFactory(DjangoModelFactory):
    class Meta:
        model = Tenant

    name = factory.Sequence(lambda n: f"Tenant {n}")
    slug = factory.Sequence(lambda n: f"tenant-{n}")
    domain = factory.Sequence(lambda n: f"tenant{n}.example.com")
    is_active = True

class UserFactory(DjangoModelFactory):
    class Meta:
        model = User

    username = factory.Sequence(lambda n: f"user{n}")
    email = factory.LazyAttribute(lambda obj: f"{obj.username}@example.com")
    first_name = factory.Faker('first_name')
    last_name = factory.Faker('last_name')
    tenant = factory.SubFactory(TenantFactory)
    is_active = True

class TicketFactory(DjangoModelFactory):
    class Meta:
        model = Ticket

    title = factory.Faker('sentence', nb_words=4)
    description = factory.Faker('text', max_nb_chars=500)
    priority = factory.Iterator(['low', 'medium', 'high', 'urgent', 'critical'])
    status = factory.Iterator(['open', 'in_progress', 'pending', 'resolved', 'closed'])
    category = factory.Iterator(['technical', 'billing', 'general', 'bug_report', 'feature_request'])
    tenant = factory.SubFactory(TenantFactory)
    created_by = factory.SubFactory(UserFactory)
```

### Frontend —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã

**package.json:**
```json
{
  "devDependencies": {
    "@testing-library/react": "^14.0.0",
    "@testing-library/jest-dom": "^5.16.5",
    "@testing-library/user-event": "^14.4.3",
    "jest": "^29.4.3",
    "jest-environment-jsdom": "^29.4.3",
    "cypress": "^12.7.0",
    "cypress-real-events": "^1.7.1"
  }
}
```

**src/setupTests.ts:**
```typescript
import '@testing-library/jest-dom';
import { configure } from '@testing-library/react';

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã
configure({ testIdAttribute: 'data-testid' });

// –ú–æ–∫ –¥–ª—è window.matchMedia
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: jest.fn().mockImplementation(query => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: jest.fn(),
    removeListener: jest.fn(),
    addEventListener: jest.fn(),
    removeEventListener: jest.fn(),
    dispatchEvent: jest.fn(),
  })),
});
```

#### Unit —Ç–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**
```typescript
// src/components/Ticket/Ticket.test.tsx
import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { Provider } from 'react-redux';
import { BrowserRouter } from 'react-router-dom';
import { Ticket } from './Ticket';
import { store } from '../../store';
import { mockTicket } from '../../mocks/ticket';

const renderWithProviders = (component: React.ReactElement) => {
  return render(
    <Provider store={store}>
      <BrowserRouter>
        {component}
      </BrowserRouter>
    </Provider>
  );
};

describe('Ticket Component', () => {
  const user = userEvent.setup();

  test('renders ticket information', () => {
    renderWithProviders(<Ticket ticket={mockTicket} />);
    
    expect(screen.getByText(mockTicket.title)).toBeInTheDocument();
    expect(screen.getByText(mockTicket.description)).toBeInTheDocument();
    expect(screen.getByText(mockTicket.priority)).toBeInTheDocument();
  });

  test('handles status change', async () => {
    const onStatusChange = jest.fn();
    renderWithProviders(
      <Ticket ticket={mockTicket} onStatusChange={onStatusChange} />
    );
    
    const statusSelect = screen.getByTestId('status-select');
    await user.selectOptions(statusSelect, 'in_progress');
    
    expect(onStatusChange).toHaveBeenCalledWith('in_progress');
  });

  test('shows comments when expanded', async () => {
    renderWithProviders(<Ticket ticket={mockTicket} />);
    
    const expandButton = screen.getByTestId('expand-comments');
    await user.click(expandButton);
    
    await waitFor(() => {
      expect(screen.getByTestId('comments-list')).toBeInTheDocument();
    });
  });
});
```

### E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### Cypress –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**cypress.config.js:**
```javascript
// cypress.config.js
const { defineConfig } = require('cypress');

module.exports = defineConfig({
  e2e: {
    baseUrl: 'http://localhost:3000',
    supportFile: 'cypress/support/e2e.ts',
    specPattern: 'cypress/e2e/**/*.cy.{js,jsx,ts,tsx}',
    viewportWidth: 1280,
    viewportHeight: 720,
    video: true,
    screenshotOnRunFailure: true,
  },
});
```

#### E2E —Ç–µ—Å—Ç—ã

**cypress/e2e/ticket-workflow.cy.ts:**
```typescript
describe('Ticket Workflow', () => {
  beforeEach(() => {
    cy.visit('/');
    cy.login('admin', 'admin123');
  });

  it('should create and manage ticket', () => {
    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞
    cy.get('[data-testid="create-ticket-button"]').click();
    
    cy.get('[data-testid="ticket-title-input"]').type('–¢–µ—Å—Ç–æ–≤—ã–π —Ç–∏–∫–µ—Ç');
    cy.get('[data-testid="ticket-description-input"]').type('–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ç–∏–∫–µ—Ç–∞');
    cy.get('[data-testid="ticket-priority-select"]').select('high');
    cy.get('[data-testid="ticket-category-select"]').select('technical');
    
    cy.get('[data-testid="submit-ticket-button"]').click();
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è
    cy.get('[data-testid="ticket-list"]').should('contain', '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–∏–∫–µ—Ç');
    
    // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ç–∏–∫–µ—Ç–∞
    cy.get('[data-testid="ticket-item"]').first().click();
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
    cy.get('[data-testid="comment-input"]').type('–ü–µ—Ä–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π');
    cy.get('[data-testid="submit-comment-button"]').click();
    
    cy.get('[data-testid="comments-list"]').should('contain', '–ü–µ—Ä–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π');
    
    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
    cy.get('[data-testid="status-select"]').select('in_progress');
    
    cy.get('[data-testid="ticket-status"]').should('contain', '–í —Ä–∞–±–æ—Ç–µ');
    
    // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞
    cy.get('[data-testid="assign-button"]').click();
    cy.get('[data-testid="assignee-select"]').select('support1');
    cy.get('[data-testid="confirm-assign-button"]').click();
    
    cy.get('[data-testid="ticket-assignee"]').should('contain', 'support1');
  });

  it('should search and filter tickets', () => {
    // –ü–æ–∏—Å–∫ —Ç–∏–∫–µ—Ç–æ–≤
    cy.get('[data-testid="search-input"]').type('–æ—à–∏–±–∫–∞');
    cy.get('[data-testid="search-button"]').click();
    
    cy.get('[data-testid="ticket-list"]').should('contain', '–æ—à–∏–±–∫–∞');
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
    cy.get('[data-testid="status-filter"]').select('open');
    cy.get('[data-testid="apply-filters-button"]').click();
    
    cy.get('[data-testid="ticket-item"]').each(($el) => {
      cy.wrap($el).should('contain', '–û—Ç–∫—Ä—ã—Ç');
    });
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
    cy.get('[data-testid="priority-filter"]').select('high');
    cy.get('[data-testid="apply-filters-button"]').click();
    
    cy.get('[data-testid="ticket-item"]').each(($el) => {
      cy.wrap($el).should('contain', '–í—ã—Å–æ–∫–∏–π');
    });
  });
});
```

### –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### Locust –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**load_tests/locustfile.py:**
```python
# load_tests/locustfile.py
from locust import HttpUser, task, between
import random

class TicketUser(HttpUser):
    wait_time = between(1, 3)
    
    def on_start(self):
        # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
        response = self.client.post("/api/auth/login/", {
            "username": "testuser",
            "password": "testpass"
        })
        self.token = response.json()["access"]
        self.headers = {"Authorization": f"Bearer {self.token}"}
    
    @task(3)
    def list_tickets(self):
        self.client.get("/api/tickets/", headers=self.headers)
    
    @task(2)
    def create_ticket(self):
        self.client.post("/api/tickets/", {
            "title": f"Test Ticket {random.randint(1, 1000)}",
            "description": "Test description",
            "priority": random.choice(["low", "medium", "high"]),
            "category": random.choice(["technical", "billing", "general"])
        }, headers=self.headers)
    
    @task(1)
    def get_ticket(self):
        ticket_id = random.randint(1, 100)
        self.client.get(f"/api/tickets/{ticket_id}/", headers=self.headers)
```

#### –ó–∞–ø—É—Å–∫ –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Locust
pip install locust

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
locust -f load_tests/locustfile.py --host=http://localhost:8000

# –ó–∞–ø—É—Å–∫ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
locust -f load_tests/locustfile.py \
  --host=http://localhost:8000 \
  --users=100 \
  --spawn-rate=10 \
  --run-time=5m

# –ó–∞–ø—É—Å–∫ –≤ headless —Ä–µ–∂–∏–º–µ
locust -f load_tests/locustfile.py \
  --host=http://localhost:8000 \
  --users=50 \
  --spawn-rate=5 \
  --run-time=2m \
  --headless
```

### CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**GitHub Actions:**
```yaml
# .github/workflows/test.yml
name: Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  backend-tests:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: test_db
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
      
      redis:
        image: redis:7
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        cd backend
        pip install -r requirements.txt
        pip install -r requirements-dev.txt
    
    - name: Run tests
      run: |
        cd backend
        python manage.py test
      env:
        DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test_db
        REDIS_URL: redis://localhost:6379/0

  frontend-tests:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    
    - name: Install dependencies
      run: |
        cd frontend
        npm ci
    
    - name: Run tests
      run: |
        cd frontend
        npm test -- --coverage --watchAll=false
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        file: frontend/coverage/lcov.info

  e2e-tests:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Install dependencies
      run: |
        cd frontend
        npm ci
    
    - name: Run Cypress tests
      run: |
        cd frontend
        npm run cypress:run
      env:
        CYPRESS_baseUrl: http://localhost:3000
```

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

#### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
```bash
# Backend –ø–æ–∫—Ä—ã—Ç–∏–µ
cd backend
coverage run --source='.' manage.py test
coverage report
coverage html

# Frontend –ø–æ–∫—Ä—ã—Ç–∏–µ
cd frontend
npm test -- --coverage
```

#### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
```bash
# Backend
cd backend
flake8 .
black --check .
isort --check-only .

# Frontend
cd frontend
npm run lint
npm run type-check
```

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤:**
- `python manage.py test` - Backend —Ç–µ—Å—Ç—ã
- `pytest` - Backend —Ç–µ—Å—Ç—ã —Å pytest
- `npm test` - Frontend —Ç–µ—Å—Ç—ã
- `npm run cypress:run` - E2E —Ç–µ—Å—Ç—ã
- `locust -f load_tests/locustfile.py` - –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `docker compose exec backend python manage.py test` - –¢–µ—Å—Ç—ã –≤ Docker

---

*–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤ [–ü–û–õ–ù–û–ï_–†–£–ö–û–í–û–î–°–¢–í–û_–ß–ê–°–¢–¨3.md](–ü–û–õ–ù–û–ï_–†–£–ö–û–í–û–î–°–¢–í–û_–ß–ê–°–¢–¨3.md)*


