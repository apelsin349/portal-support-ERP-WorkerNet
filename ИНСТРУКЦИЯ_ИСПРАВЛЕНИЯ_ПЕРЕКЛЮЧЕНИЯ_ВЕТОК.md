# Инструкция исправления проблемы с переключением веток

## Проблема
После исправления проблемы с пробелами появилась новая проблема:
```
[ИНФО] Выбрана ветка: new-frontend
[ИНФО] Проверяем наличие обновлений в ветке 'new-frontend'...
[ИНФО] Переключаемся на ветку 'new-frontend'...
[ОШИБКА] Не удалось переключиться на ветку 'new-frontend'
```

## Быстрое исправление

### Вариант 1: Автоматическое исправление
Выполните следующие команды на сервере:

```bash
# Перейдите в директорию проекта
cd ~/portal-support-ERP-WorkerNet

# Скачайте и запустите скрипт исправления
curl -fsSL https://raw.githubusercontent.com/apelsin349/portal-support-ERP-WorkerNet/main/scripts/fix-branch-switch-issue.sh -o scripts/fix-branch-switch-issue.sh
chmod +x scripts/fix-branch-switch-issue.sh
bash scripts/fix-branch-switch-issue.sh
```

### Вариант 2: Ручное исправление
Выполните команды вручную:

```bash
# Перейдите в директорию проекта
cd ~/portal-support-ERP-WorkerNet

# Обновите удаленные ссылки
git fetch --all --prune --force
git remote update

# Проверьте текущую ветку
current_branch=$(git branch --show-current 2>/dev/null || git rev-parse --abbrev-ref HEAD 2>/dev/null || echo "main")
echo "Текущая ветка: $current_branch"

# Если находитесь в detached HEAD, переключитесь на main
if [ "$current_branch" = "HEAD" ] || [[ "$current_branch" =~ ^[0-9a-f]{7,}$ ]]; then
    echo "Обнаружено состояние detached HEAD, переключаемся на main..."
    git checkout main 2>/dev/null || git checkout -b main origin/main 2>/dev/null || true
fi

# Удалите проблемную локальную ветку new-frontend если она существует
if git show-ref --verify --quiet "refs/heads/new-frontend"; then
    echo "Удаляем проблемную локальную ветку new-frontend..."
    git branch -D new-frontend 2>/dev/null || true
fi

# Создайте новую локальную ветку из удаленной
echo "Создаем новую локальную ветку new-frontend из origin/new-frontend..."
git checkout -b new-frontend origin/new-frontend

echo "Исправление завершено!"
```

### Вариант 3: Одноразовая команда
Выполните эту команду для быстрого исправления:

```bash
cd ~/portal-support-ERP-WorkerNet && git fetch --all --prune --force && git remote update && current_branch=$(git branch --show-current 2>/dev/null || git rev-parse --abbrev-ref HEAD 2>/dev/null || echo "main") && if [ "$current_branch" = "HEAD" ] || [[ "$current_branch" =~ ^[0-9a-f]{7,}$ ]]; then git checkout main 2>/dev/null || git checkout -b main origin/main 2>/dev/null || true; fi && if git show-ref --verify --quiet "refs/heads/new-frontend"; then git branch -D new-frontend 2>/dev/null || true; fi && git checkout -b new-frontend origin/new-frontend && echo "Исправление завершено!"
```

## Диагностика проблем

Если исправление не помогло, запустите диагностику:

```bash
# Полная диагностика
bash scripts/diagnose-git-branch-issue.sh

# Только диагностика
bash scripts/diagnose-git-branch-issue.sh --diagnose

# Только исправление
bash scripts/diagnose-git-branch-issue.sh --fix

# Только тестирование
bash scripts/diagnose-git-branch-issue.sh --test
```

## Проверка исправления

После применения исправлений проверьте:

```bash
# Проверьте, что ветка new-frontend существует
git branch -a | grep new-frontend

# Попробуйте переключиться на ветку
git checkout new-frontend

# Запустите скрипт обновления
bash scripts/quick-update.sh

# Или используйте конкретную ветку
bash scripts/quick-update.sh --branch new-frontend
```

## Что исправляется

1. **Обновление удаленных ссылок** - синхронизация с удаленным репозиторием
2. **Исправление detached HEAD** - переключение на корректную ветку
3. **Удаление проблемной ветки** - очистка поврежденной локальной ветки
4. **Создание новой ветки** - создание корректной локальной ветки из удаленной

## Возможные причины проблемы

1. **Detached HEAD состояние** - репозиторий находится в состоянии detached HEAD
2. **Поврежденная локальная ветка** - локальная ветка new-frontend повреждена
3. **Устаревшие удаленные ссылки** - локальная копия не синхронизирована с удаленным репозиторием
4. **Конфликты слияния** - активные операции merge/rebase/cherry-pick

## Альтернативные способы

Если проблема повторяется, используйте:

```bash
# Прямое указание ветки
bash scripts/quick-update.sh --branch new-frontend

# Через переменную окружения
export WORKERNET_BRANCH=new-frontend
bash scripts/quick-update.sh

# Неинтерактивный режим
WORKERNET_NONINTERACTIVE=1 bash scripts/quick-update.sh --branch new-frontend

# Принудительное обновление
bash scripts/quick-update.sh --force --branch new-frontend
```

## Восстановление

Если что-то пошло не так, можно восстановить состояние:

```bash
# Вернуться на main
git checkout main

# Удалить проблемную ветку
git branch -D new-frontend

# Создать ветку заново
git checkout -b new-frontend origin/new-frontend
```
