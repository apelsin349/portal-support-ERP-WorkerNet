# Инструкции по тестированию выбора репозитория

## Проблема
Скрипт не спрашивает о выборе репозитория в режиме обновления.

## Отладочная информация добавлена

### ✅ Добавлены DEBUG сообщения:
- Начальные значения переменных
- Состояние REPO_URL
- Переменные окружения (CI, WORKERNET_NONINTERACTIVE)
- Вызовы функций select_repository
- Логика выбора в режиме обновления

## Тестирование

### 1. Запуск основного скрипта
```bash
# Перейти в директорию скриптов
cd scripts

# Запустить скрипт
bash universal-install-update.sh
```

### 2. Проверить DEBUG сообщения
Скрипт должен показать:
```
[ИНФО] DEBUG: Начальные значения переменных:
[ИНФО] DEBUG: WORKERNET_REPO_URL = ''
[ИНФО] DEBUG: REPO_URL = ''
[ИНФО] DEBUG: CI = ''
[ИНФО] DEBUG: WORKERNET_NONINTERACTIVE = ''

[ИНФО] DEBUG: Режим обновления - определяем репозиторий
[ИНФО] DEBUG: REPO_URL = ''
[ИНФО] DEBUG: REPO_URL пустой, переходим к интерактивному выбору
[ИНФО] DEBUG: Найден существующий репозиторий: https://github.com/...
[ИНФО] DEBUG: Ожидаем ввод пользователя...
```

### 3. Тестирование с переменными окружения

**Тест 1: Без переменных (должен спросить)**
```bash
bash universal-install-update.sh
```

**Тест 2: С установленным репозиторием (не должен спрашивать)**
```bash
WORKERNET_REPO_URL=https://github.com/test/repo.git bash universal-install-update.sh
```

**Тест 3: Неинтерактивный режим (не должен спрашивать)**
```bash
WORKERNET_NONINTERACTIVE=1 bash universal-install-update.sh
```

**Тест 4: CI режим (не должен спрашивать)**
```bash
CI=1 bash universal-install-update.sh
```

### 4. Тестирование режима новой установки

Для тестирования режима новой установки:
1. Удалите существующую установку
2. Или запустите скрипт в чистой среде

## Ожидаемое поведение

### ✅ Режим обновления (должен работать):
```
[ИНФО] Обновление существующей установки
Текущий репозиторий: https://github.com/apelsin349/portal-support-ERP-WorkerNet.git

Выберите действие:
1) Обновить из текущего репозитория
2) Сменить репозиторий
3) Использовать текущий (по умолчанию)

Введите номер (1-3):
```

### ✅ Режим новой установки (должен работать):
```
[ИНФО] Выберите Git репозиторий для установки:
1) Основной репозиторий (github.com/apelsin349/portal-support-ERP-WorkerNet)
2) Указать другой репозиторий
3) Использовать основной (по умолчанию)

Введите номер (1-3):
```

## Диагностика проблем

### Если скрипт не спрашивает:

1. **Проверьте DEBUG сообщения** - покажут, где происходит проблема
2. **Проверьте переменные окружения** - могут быть установлены CI или WORKERNET_NONINTERACTIVE
3. **Проверьте самообновление** - может загружать старую версию
4. **Проверьте режим установки** - может определяться неправильно

### Возможные причины:
- Переменная WORKERNET_REPO_URL установлена
- Переменная WORKERNET_NONINTERACTIVE установлена
- Переменная CI установлена
- Самообновление загрузило старую версию скрипта
- Логика определения режима работает неправильно

## Отладка

### Включить подробную отладку:
```bash
set -x  # Включить отладку bash
bash universal-install-update.sh
set +x  # Выключить отладку bash
```

### Проверить переменные окружения:
```bash
env | grep WORKERNET
env | grep CI
```

---

**Дата создания**: 2025-01-27  
**Статус**: ✅ Готово к тестированию  
**Версия скрипта**: 2025-01-27.1
